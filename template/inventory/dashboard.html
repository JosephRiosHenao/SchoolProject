{% extends "base.html" %}
{% block title %}Dashboard{% endblock title %}
{% block css %}
  <style>
    @import "https://code.highcharts.com/css/highcharts.css";

    .highcharts-pie-series .highcharts-point {
        stroke: #ede;
        stroke-width: 2px;
    }
    
    .highcharts-pie-series .highcharts-data-label-connector {
        stroke: silver;
        stroke-dasharray: 2, 2;
        stroke-width: 2px;
    }
    
    .highcharts-figure,
    .highcharts-data-table table {
        min-width: 320px;
        max-width: 600px;
        margin: 1em auto;
    }
    
    .highcharts-data-table table {
        font-family: Verdana, sans-serif;
        border-collapse: collapse;
        border: 1px solid #ebebeb;
        margin: 10px auto;
        text-align: center;
        width: 100%;
        max-width: 500px;
    }
    
    .highcharts-data-table caption {
        padding: 1em 0;
        font-size: 1.2em;
        color: #555;
    }
    
    .highcharts-data-table th {
        font-weight: 600;
        padding: 0.5em;
    }
    
    .highcharts-data-table td,
    .highcharts-data-table th,
    .highcharts-data-table caption {
        padding: 0.5em;
    }
    
    .highcharts-data-table thead tr,
    .highcharts-data-table tr:nth-child(even) {
        background: #f8f8f8;
    }
    
    .highcharts-data-table tr:hover {
        background: #f1f7ff;
    }
    

    #result {
        text-align: right;
        color: gray;
        min-height: 2em;
      }
      
      #table-sparkline {
        margin: 0 auto;
        border-collapse: collapse;
      }
      
      th {
        font-weight: bold;
        text-align: left;
      }
      
      td,
      th {
        padding: 5px;
        border-bottom: 1px solid silver;
        height: 20px;
      }
      
      thead th {
        border-top: 2px solid gray;
        border-bottom: 2px solid gray;
      }
      
      .highcharts-tooltip>span {
        background: white;
        border: 1px solid silver;
        border-radius: 3px;
        box-shadow: 1px 1px 2px #888;
        padding: 8px;
      }
      
      #table-sparkline .highcharts-exporting-group{
        display: none;
      }
    
  </style>
{% endblock css %}
{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-4">

            <!-- Dropdown Card Example -->
            <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div
                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Dropdown Card Example</h6>
                    <div class="dropdown no-arrow">
                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                            aria-labelledby="dropdownMenuLink">
                            <div class="dropdown-header">Dropdown Header:</div>
                            <button class="dropdown-item" id="plain">Action</button>
                            <button class="dropdown-item" id="inverted">Another action</button>
                            <button class="dropdown-item" id="polar">Another action</button>

                        </div>
                    </div>
                </div>
                <!-- Card Body -->
                <div class="card-body" id="containerGrap"></div>
            </div>
        </div>
        <div class="col-lg-8">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Basic Card Example</h6>
                </div>
                <div class="card-body" id="containerEarnings"></div>
            </div>
        </div>
    </div>
    <div class="row">


        
        <div class="col-lg-8">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Basic Card Example</h6>
                </div>
                <div id="containerCustomers" class="card-body">
                    <!-- <div id="result"></div> -->
                    <table id="table-sparkline"  style="width: 100%;">
                        <thead>
                            <tr>
                                <th>State</th>
                                <th>Income</th>
                                <th>Income per quarter</th>
                                <th>Costs</th>
                                <th>Costs per quarter</th>
                                <th>Result</th>
                                <th>Result per quarter</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-sparkline">
                            <tr>
                                <th>Alabama</th>
                                <td>254</td>
                                <td data-sparkline="71, 78, 39, 66 "/>
                                <td>296</td>
                                <td data-sparkline="68, 52, 80, 96 "/>
                                <td>-42</td>
                                <td data-sparkline="3, 26, -41, -30 ; column"/>
                            </tr>
                            <tr>
                                <th>Alaska</th>
                                <td>246</td>
                                <td data-sparkline="87, 44, 74, 41 "/>
                                <td>181</td>
                                <td data-sparkline="29, 54, 73, 25 "/>
                                <td>65</td>
                                <td data-sparkline="58, -10, 1, 16 ; column"/>
                            </tr>
                            <tr>
                                <th>Arizona</th>
                                <td>101</td>
                                <td data-sparkline="56, 12, 8, 25 "/>
                                <td>191</td>
                                <td data-sparkline="69, 14, 53, 55 "/>
                                <td>-90</td>
                                <td data-sparkline="-13, -2, -45, -30 ; column"/>
                            </tr>
                            <tr>
                                <th>Arkansas</th>
                                <td>303</td>
                                <td data-sparkline="81, 50, 78, 94 "/>
                                <td>76</td>
                                <td data-sparkline="36, 15, 14, 11 "/>
                                <td>227</td>
                                <td data-sparkline="45, 35, 64, 83 ; column"/>
                            </tr>
                            <tr>
                                <th>California</th>
                                <td>200</td>
                                <td data-sparkline="61, 80, 10, 49 "/>
                                <td>217</td>
                                <td data-sparkline="100, 8, 52, 57 "/>
                                <td>-17</td>
                                <td data-sparkline="-39, 72, -42, -8 ; column"/>
                            </tr>
                            <tr>
                                <th>Colorado</th>
                                <td>118</td>
                                <td data-sparkline="13, 48, 21, 36 "/>
                                <td>273</td>
                                <td data-sparkline="98, 86, 8, 81 "/>
                                <td>-155</td>
                                <td data-sparkline="-85, -38, 13, -45 ; column"/>
                            </tr>
                            <tr>
                                <th>Connecticut</th>
                                <td>201</td>
                                <td data-sparkline="6, 64, 44, 87 "/>
                                <td>148</td>
                                <td data-sparkline="60, 13, 73, 2 "/>
                                <td>53</td>
                                <td data-sparkline="-54, 51, -29, 85 ; column"/>
                            </tr>
                            <tr>
                                <th>Delaware</th>
                                <td>161</td>
                                <td data-sparkline="7, 27, 49, 78 "/>
                                <td>298</td>
                                <td data-sparkline="19, 90, 100, 89 "/>
                                <td>-137</td>
                                <td data-sparkline="-12, -63, -51, -11 ; column"/>
                            </tr>
                            <tr>
                                <th>District of Columbia</th>
                                <td>106</td>
                                <td data-sparkline="18, 39, 27, 22 "/>
                                <td>185</td>
                                <td data-sparkline="62, 97, 24, 2 "/>
                                <td>-79</td>
                                <td data-sparkline="-44, -58, 3, 20 ; column"/>
                            </tr>
                            <tr>
                                <th>Florida</th>
                                <td>249</td>
                                <td data-sparkline="51, 24, 90, 84 "/>
                                <td>244</td>
                                <td data-sparkline="47, 40, 74, 83 "/>
                                <td>5</td>
                                <td data-sparkline="4, -16, 16, 1 ; column"/>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Basic Card Example</h6>
                </div>
                <div class="card-body" id="containerProducts"></div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}
{% block js %}
    <script>
        const chart = Highcharts.chart('containerGrap', {
            title: {
                text: 'Chart.update'
            },
            subtitle: {
                text: 'Plain'
            },
            xAxis: {
                categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
            },
            series: [{
                type: 'column',
                colorByPoint: true,
                data: [29.9, 71.5, 106.4, 129.2, 144.0, 176.0, 135.6, 148.5, 216.4, 194.1, 95.6, 54.4],
                showInLegend: false
            }]
        });
        
        document.getElementById('plain').addEventListener('click', () => {
            chart.update({
                chart: {
                    inverted: false,
                    polar: false
                },
                subtitle: {
                    text: 'Plain'
                }
            });
        });
        
        document.getElementById('inverted').addEventListener('click', () => {
            chart.update({
                chart: {
                    inverted: true,
                    polar: false
                },
                subtitle: {
                    text: 'Inverted'
                }
            });
        });
        
        document.getElementById('polar').addEventListener('click', () => {
            chart.update({
                chart: {
                    inverted: false,
                    polar: true
                },
                subtitle: {
                    text: 'Polar'
                }
            });
        });
               

        Highcharts.chart('containerProducts', {

            chart: {
                styledMode: true
            },
        
            title: {
                text: 'Pie point CSS'
            },
        
            xAxis: {
                categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
            },
        
            series: [{
                type: 'pie',
                allowPointSelect: true,
                keys: ['name', 'y', 'selected', 'sliced'],
                data: [
                    ['Apples', 29.9, false],
                    ['Pears', 71.5, false],
                    ['Oranges', 106.4, false],
                    ['Plums', 129.2, false],
                    ['Bananas', 144.0, false],
                    ['Peaches', 176.0, false],
                    ['Prunes', 135.6, true, true],
                    ['Avocados', 148.5, false]
                ],
                showInLegend: true
            }]
        });

        Highcharts.getJSON(
            'https://cdn.jsdelivr.net/gh/highcharts/highcharts@v7.0.0/samples/data/usdeur.json',
            function (data) {
        
                Highcharts.chart('containerEarnings', {
                    chart: {
                        zoomType: 'x'
                    },
                    title: {
                        text: 'USD to EUR exchange rate over time'
                    },
                    subtitle: {
                        text: document.ontouchstart === undefined ?
                            'Click and drag in the plot area to zoom in' : 'Pinch the chart to zoom in'
                    },
                    xAxis: {
                        type: 'datetime'
                    },
                    yAxis: {
                        title: {
                            text: 'Exchange rate'
                        }
                    },
                    legend: {
                        enabled: false
                    },
                    plotOptions: {
                        area: {
                            fillColor: {
                                linearGradient: {
                                    x1: 0,
                                    y1: 0,
                                    x2: 0,
                                    y2: 1
                                },
                                stops: [
                                    [0, Highcharts.getOptions().colors[0]],
                                    [1, Highcharts.color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                                ]
                            },
                            marker: {
                                radius: 2
                            },
                            lineWidth: 1,
                            states: {
                                hover: {
                                    lineWidth: 1
                                }
                            },
                            threshold: null
                        }
                    },
        
                    series: [{
                        type: 'area',
                        name: 'USD to EUR',
                        data: data
                    }]
                });
            }
        );
        
/**
 * Create a constructor for sparklines that takes some sensible defaults and merges in the individual
 * chart options. This function is also available from the jQuery plugin as $(element).highcharts('SparkLine').
 */
 Highcharts.SparkLine = function (a, b, c) {
    const hasRenderToArg = typeof a === 'string' || a.nodeName;
    let options = arguments[hasRenderToArg ? 1 : 0];
    const defaultOptions = {
        chart: {
            renderTo: (options.chart && options.chart.renderTo) || (hasRenderToArg && a),
            backgroundColor: null,
            borderWidth: 0,
            type: 'area',
            margin: [2, 0, 2, 0],
            width: 120,
            height: 20,
            style: {
                overflow: 'visible'
            },
            // small optimalization, saves 1-2 ms each sparkline
            skipClone: true
        },
        title: {
            text: ''
        },
        credits: {
            enabled: false
        },
        xAxis: {
            labels: {
                enabled: false
            },
            title: {
                text: null
            },
            startOnTick: false,
            endOnTick: false,
            tickPositions: []
        },
        yAxis: {
            endOnTick: false,
            startOnTick: false,
            labels: {
                enabled: false
            },
            title: {
                text: null
            },
            tickPositions: [0]
        },
        legend: {
            enabled: false
        },
        tooltip: {
            hideDelay: 0,
            outside: true,
            shared: true
        },
        plotOptions: {
            series: {
                animation: false,
                lineWidth: 1,
                shadow: false,
                states: {
                    hover: {
                        lineWidth: 1
                    }
                },
                marker: {
                    radius: 1,
                    states: {
                        hover: {
                            radius: 2
                        }
                    }
                },
                fillOpacity: 0.25
            },
            column: {
                negativeColor: '#910000',
                borderColor: 'silver'
            }
        }
    };

    options = Highcharts.merge(defaultOptions, options);

    return hasRenderToArg ?
        new Highcharts.Chart(a, options, c) :
        new Highcharts.Chart(options, b);
};

const start = +new Date(),
    tds = Array.from(document.querySelectorAll('td[data-sparkline]')),
    fullLen = tds.length;

let n = 0;

// Creating 153 sparkline charts is quite fast in modern browsers, but IE8 and mobile
// can take some seconds, so we split the input into chunks and apply them in timeouts
// in order avoid locking up the browser process and allow interaction.
function doChunk() {
    const time = +new Date(),
        len = tds.length;

    for (let i = 0; i < len; i += 1) {
        const td = tds[i];
        const stringdata = td.dataset.sparkline;
        const arr = stringdata.split('; ');
        const data = arr[0].split(', ').map(parseFloat);
        const chart = {};

        if (arr[1]) {
            chart.type = arr[1];
        }

        Highcharts.SparkLine(td, {
            series: [{
                data: data,
                pointStart: 1
            }],
            tooltip: {
                headerFormat: '<span style="font-size: 10px">' + td.parentElement.querySelector('th').innerText + ', Q{point.x}:</span><br/>',
                pointFormat: '<b>{point.y}.000</b> USD'
            },
            chart: chart
        });

        n += 1;

        // If the process takes too much time, run a timeout to allow interaction with the browser
        if (new Date() - time > 500) {
            tds.splice(0, i + 1);
            setTimeout(doChunk, 0);
            break;
        }

        // Print a feedback on the performance
        if (n === fullLen) {
            document.getElementById('result').innerHTML = 'Generated ' + fullLen + ' sparklines in ' + (new Date() - start) + ' ms';
        }
    }
}
doChunk();



    </script>
{% endblock js %}